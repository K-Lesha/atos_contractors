<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>–ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –ø–æ–¥—Ä—è–¥—á–∏–∫–æ–≤</title>
  <style>
    :root {
      --bg: #f9f9f9;
      --fg: #212121;
      --card-bg: #fff;
      --card-border: #ddd;
      --accent: #1976d2;
    }
    body {
      font-family: -apple-system, BlinkMacSystemFont, Roboto, "Segoe UI", sans-serif;
      background: var(--bg);
      color: var(--fg);
      margin: 0;
      padding: 1rem;
      line-height: 1.45;
    }
    h2 {
      margin: 1.6rem 0 .6rem;
    }
    .card {
      background: var(--card-bg);
      border: 1px solid var(--card-border);
      border-radius: 6px;
      padding: 8px 10px;
      margin-bottom: 8px;
      box-shadow: 0 1px 2px rgba(0,0,0,.04);
    }
    a {
      color: var(--accent);
      text-decoration: none;
    }
    a:hover { text-decoration: underline; }
    #status { opacity: .6; }
  </style>
</head>
<body>
  <div id="root">
    <p id="status">–ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ‚Ä¶</p>
  </div>

  <script>
const API_URL = 'https://betters-technology.site/webhook/categories';

async function loadCategories() {
  const root   = document.getElementById('root');
  const status = document.getElementById('status');

  try {
    const resp = await fetch(API_URL);
    if (!resp.ok) throw new Error(`HTTP ${resp.status}`);

    const data = await resp.json();

    // –ü–û–î–°–¢–†–ê–•–û–í–ö–ê: —É–±–µ–¥–∏–º—Å—è, —á—Ç–æ –ø–æ–ª—É—á–∏–ª–∏ –∏–º–µ–Ω–Ω–æ –º–∞—Å—Å–∏–≤
    const categories = Array.isArray(data) ? data
                   : (Array.isArray(data.data) ? data.data : null);

    if (!categories) throw new Error('–ù–µ–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–π —Ñ–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞');

    status.remove();                          // —É–±–∏—Ä–∞–µ–º ¬´–ó–∞–≥—Ä—É–∂–∞–µ–º‚Ä¶¬ª
    const frag = document.createDocumentFragment();

    categories.forEach(cat => {
      const h2 = document.createElement('h2');
      h2.textContent = cat.name || '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è';
      frag.appendChild(h2);

      (cat.subcontractors || []).forEach(s => {
        const card = document.createElement('div');
        card.className = 'card';
        card.innerHTML = `
          <strong>${s.name ?? ''}</strong><br>
          ${s.description ?? ''}<br>
          ${s.contacts ?? ''}<br>
          ${s.link ? `<a href="${s.link}" target="_blank" rel="noopener">${s.link}</a>` : ''}
        `;
        frag.appendChild(card);
      });
    });

    if (!categories.length) {
      root.textContent = '–ü—É—Å—Ç–æ: –∫–∞—Ç–µ–≥–æ—Ä–∏–π –Ω–µ—Ç ü§∑‚Äç‚ôÇÔ∏è';
    } else {
      root.appendChild(frag);                 // –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
    }

  } catch (err) {
    console.error(err);
    if (status && status.isConnected) {
      status.textContent = '–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ üòî';
    } else {
      root.textContent = '–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ üòî';
    }
  }
}

document.addEventListener('DOMContentLoaded', loadCategories);
</script>
</body>
</html>
